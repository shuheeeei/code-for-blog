# 説明をあまり妥協しないreact-hook-formの使い方
または
# react-hook-formの使い方をちゃんと解説してみた

## react-hook-formの基本編
### はじめに
  未経験からバックエンドエンジニアになり1年ほど働いた後、４ヶ月ほど前からプロジェクトが変わってなんやかんやあってフロントエンジニアになりました。<br>
  その中で業務で使う機会の多かったreact-hook-formというライブラリについて、簡単で便利なので紹介してみようと思い書きました。<br>
  ※ エンジニアとしてもフロントエンジニアとしてもなりたてホヤホヤですので、暖かい心で読んでいただければと…！
  ※ 紹介するのはNativeではなくWebの方のみです。

### 対象の方
Reactの基礎はわかっているレベル以上の方

### 本記事の内容
- react-hook-formの説明
- 使うための準備
- 基本的な使い方（ざっくり）
- 基本的な使い方（細かく）

### react-hook-formとは？
雑にまとめると「バリデーションなどの多くの機能がありながら少ないコード量で書ける良パフォーマンスなフォームをお届けしてくれるライブラリ」です。良さはドキュメントのトップに定量的でわかりやすい説明があるのでぜひ見てみてください！<br>
本記事では使い方にフォーカスします。<br>
→ 公式ドキュメント：https://react-hook-form.com/jp/

### はじめてみる ~ インストールなどの準備
- 実行環境
本記事を書くにあたり私が準備した環境です。
  ```js
    - React: 16.13.1
    - TypeScript: 3.9.3
    - react-hook-form: 6.3.0
  ```
- インストール
  - `npm install react-hook-form`

### 使ってみるその１（ざっくりとした基本）
  - 最初に最も簡単な使い方をご紹介します。
  - 基本的には`useForm`というhookを使ってformを作っていきます。the hooksという感じのお名前で良いですね。
  - 大まかな手順
    1. `useForm`をimportして必要なメソッド等を持ってくる（初期値などの設定もここで行う）
    2. formの中身を書き、ref属性にuseFormの`register`を渡して管理対象とする
    3. 送信データを受け取って処理を行うコールバック関数を作り、useFormの`handleSubmit`関数の引数に持たせたものをformタグのonSubmitに渡す。
  - `コードを書きたい [1つめ]`

  - 上記のコードについて実装の流れを説明します。
    - `useForm`をimportする
    - 定義して必要なメソッドや情報を持ってくる。今回は`register`と`handleSubmit`の２つだけ。
    - formタグのonSubmitにuseFormから持ってきた`handleSubmit`を当てる
      - 送信データを受け取り、そのデータを使った送信時の処理を持ったコールバック関数を作る。
      - formタグのonSubmitにhandleSubmit関数を持たせる
        handleSubmitの引数には前述したコールバック関数を渡す
    - input等のform系の要素のref属性にregisterを渡す
  - handleSubmitはreact-hook-formのバリデーションの実行と、バリデーション通過後のデータの受け渡しのお仕事をしてくれますので、onSubmitに直接コールバック関数を渡すのではなくhandleSubmit経由で渡してあげましょう。registerで設定したバリデーションをクリアしていないと動かないように制御してくれます。
  今回はonSubmitの処理は受け取った値をプロフィールっぽい感じに整えてuseStateのsetterで管理してsend dataの部分で表示されるようにしています。。
  - 各form系タグのname属性は、送信データのキーになるのでわかりやすく設定しましょう。
    - `submitDataの例を書きたい`
  - `画面のスクショ`
  - formの値に初期値を入れたいな、という場合には下記のようにuseFormの引数に`defaultValues`プロパティを設定してあげます。
  - `defaultValuesあたりのみのコードを書く`
  - `スクショ`
  <hr >
  - これだけではreact-hook-formの機能をほぼ使用できていないものの、最低限の実装ができました。

### 使ってみるその２（バリデーション）
  - 次にFormのバリデーションをご紹介します。
  - form系タグのref属性に渡したregisterを使ってバリデーションを実装できます。
  - 実装方法はref属性の`register`を`register()`に変えて中身にオブジェクトリテラルでバリデーション設定を書いていくだけです。
    1. 入力を必須にする
        - 下記のように設定します。
      エラーメッセージも合わせて設定できます。省略もできます。
      `lastNameのinputだけのコード`
        - エラーメッセージはどこから取るのか？
        と思われたかと思うので説明します。
        useFormから`erros`という変数を持ってくれば、その中にエラーメッセージがあれば格納されているので表示させればOKです。
        データ構造は、プロパティがname属性に指定した名前で値がmessageをプロパティに設定したエラーメッセージをもつオブジェクトになっている二重構造のオブジェクトになっています。
        今回だと下記の通りです。
        ```js
        errors = {
          lastName: { message: '苗字を入力してください' },
        };
        ```
        因みにですが、バリデーションに引っかかった項目のname属性だけが`errors`のプロパティに存在しますので、何もエラーがなければ空のオブジェクトになります。
        ということで次のように書いておけばエラーがあるときだけ表示できますね。
        ```js
        {errors.lastName && errors.lastName.message}
        ```
    2. 最大・最小値を設定する
        - 下記のように設定します。
      `required`と同じくエラーメッセージも合わせて設定できます。
      最大値と最小値の数を同じにすれば入力文字数を1つに固定できます。
      `firstNameのinputだけのコード`
    3. 数値の最大・最小
         - 下記のように設定します。
      `required`と同じくエラーメッセージも合わせて設定できます。
      minなら指定値「以上」、maxなら指定値「以下」の値を受け付けるようになります。
      `ageのinputだけのコード`
    4. 特定の入力パターンを検知する
         - 下記のように設定します。（ドキュメントの日本語がわかりづらかった。。。）
      同じくエラーメッセージも合わせて設定できます。
      minなら指定値「以上」、maxなら指定値「以下」の値を受け付けるようになります。
      `lastNameのinputだけのコード`
    5. 自前のバリデーションを作る
         - 下記のように設定します。（ドキュメントだとどうなったらバリデーションをクリアできるのかわからんかったんや。。。）
      同じくエラーメッセージも合わせて設定できます。
      validateプロパティにバリデーション処理をもつコールバック関数を設定してあげます。
      引数名は任意で、対象の入力データを受け取る関数にしてあげます
      このコールバック関数の返り値がtrueならバリデーションを通過したことになり、エラーメッセージを返せばバリデーションはエラーになってerrorsに設定されます。
      （trueならスルー…(バリデーションを)）
      コールバック関数の中でバリデーション用のAPIを叩いても良さそうです。

      `lastNameのinputだけのコード`
    
    3. 前述しましたが、バリデーションに引っかかっているとonSubmitが動かないのでconsoleには送信データは表示されていないはずです
  - `コードを書きたい [２つめ]`

### 使ってみるその３（その他に使えるメソッド達）
  - 最後にuseFormから持ってこれるメソッドの中でwatchとformStateをご紹介します。
    どちらもformの入力や送信時に役立つものです。
  #### watch
  refにregisterを渡しているform要素の値の監視と値の取得ができる関数です。
  watchの引数に監視・取得したい対象のname属性を入れるだけで使えます。
  全部監視したいときは引数は空で、特定の項目だけなら配列で渡します。
  データ構造は、指定したプロパティにname属性、値に入力値をもつオブジェクトになっています。
  - `コードを書きたい`
  チェックを入れたら項目に応じたFormを展開するとか、いろいろできそうです。

  #### formState
  - formStateから取得できる`isDirty`, `isSubmitting`, `touched`, `submitCount`の4つをご紹介（ドキュメントに合わせた）
  ##### isDirty
  - 管理対象のformの中で、値が初期から変わったかどうかをリアルタイムで判定してくれます。
  　値に変更があるのに送信せずにページを離れようとした時にアラートを出す、などで使えそうです。
  - isDirtyのコードとスクショ
  ##### isSubmitting
  - 送信ボタンを押したときに、送信処理を行っている間だけtrueになるBooleanです。
  - 送信ボタンに使ってdisabled属性を制御してあげて二重送信を防げたりできそうです。
  - isSubmittingのコード
  ##### touched
  - 管理対象のformの中で、値が初期から変わった項目の一覧をもつオブジェクト。要するにisDirtyの全体版です。
  - 例えば苗字（lastName）だけ変更した場合にはtouchedは`{lastName: true}`となります。
  - touchedのコード
  ##### submitCount
  - 何回送信処理を行ったかを格納している変数です。
  - 初期値はもちろん０で、送信ボタンを押すごとに１ずつインクリメントされます。
  - 一度に３回以上変更したら値を変更できないようにする、とかで使うんですかね…？
  - submitCountのコード

以上、react-hook-formの簡単なご紹介でした〜。
